{let a=globalThis.fetch,n=globalThis.document.createElement,l=globalThis.timestamp,o="timestamp";let e=localStorage,t=caches,i=e.getItem(o);Number(l)!==Number(i)&&(i&&await t.has(i)&&await t.delete(i),e.setItem(o,l));let r=await t.open(l),s=new Set;function h(...e){return new URL(...e)}function c(e){return e instanceof URL?e:e instanceof Request?h(e.url):h(e)}globalThis.fetch=async(e,t)=>c(e).origin!==location.origin?a(e,t):(t=t,e=c(e=e),(t=(t=t)??{}).cache="force-cache",e.search="",e.searchParams.set("timestamp",l),e=new Request(e,t),(await r.match(e)||(t=await a(e),await r.put(e,t.clone()),t)).clone()),globalThis.document.createElement=(e,t)=>{let c=n.bind(document)(e,t);if(c instanceof HTMLLinkElement){let i=c.setAttribute;c.setAttribute=async(e,a)=>{if("prefetch"===c.rel&&"href"===e){let n=`${a}?${o}=`+l;let t=h(location.origin+n);void(await r.match(new Request(t))||s.has(t.href)||(i.call(c,e,n),c.addEventListener("load",function e(){s.add(t.href),c.removeEventListener("load",e)})))}else i.call(c,e,a)}}return c}}