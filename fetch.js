{let a=globalThis.fetch,n=globalThis.document.createElement,r=globalThis.timestamp,o="timestamp";let e=localStorage,t=caches,i=e.getItem(o);Number(r)!==Number(i)&&(i&&await t.has(i)&&await t.delete(i),e.setItem(o,r));class u{key="prefetch-cache";entries=new Set(JSON.parse(sessionStorage.getItem(this.key)||"[]"));constructor(e){e.keys().then(e=>{e.forEach(e=>{this.entries.add(e.url)})}),window.addEventListener("beforeunload",()=>{sessionStorage.setItem(this.key,JSON.stringify([...this.entries.values()]))})}has(e){return this.entries.has(e)}add(e){this.entries.add(e)}}let c=await t.open(r),l=new u(c);function h(...e){return new URL(...e)}function s(e){return e instanceof URL?e:e instanceof Request?h(e.url):h(e,location.origin)}globalThis.fetch=async(e,t)=>s(e).origin!==location.origin?a(e,t):(t=t,e=s(e=e),(t=(t=t)??{}).cache="force-cache",e.search="",e.searchParams.set("timestamp",r),e=new Request(e,t),(await c.match(e)||(t=await a(e),await c.put(e,t.clone()),t)).clone()),globalThis.document.createElement=(e,t)=>{let s=n.bind(document)(e,t);if(s instanceof HTMLLinkElement){let i=s.setAttribute;s.setAttribute=async(e,a)=>{if("prefetch"===s.rel&&"href"===e){let n=`${a}?${o}=`+r;let t=h(location.origin+n);return l.has(t.href)?void 0:void(await c.match(new Request(t))||(i.call(s,e,n),s.addEventListener("load",function e(){l.add(t.href),s.removeEventListener("load",e)})))}i.call(s,e,a)}}return s}}