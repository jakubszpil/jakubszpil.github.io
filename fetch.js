{let a=globalThis.fetch,n=globalThis.document.createElement,l=globalThis.timestamp;let e=localStorage.getItem("timestamp");Number(l)!==Number(e)&&(e&&await window.caches.has(e)&&await window.caches.delete(e),localStorage.setItem("timestamp",l));let o=await window.caches.open(l),s=new Set;function i(e){return e instanceof URL?e:e instanceof Request?new URL(e.url):new URL(e)}globalThis.fetch=async(e,t)=>i(e).origin!==location.origin?a(e,t):(t=t,e=i(e=e),(t=(t=t)??{}).cache="force-cache",e.search="",e.searchParams.set("timestamp",l),e=new Request(e,t),(await o.match(e)||(t=await a(e),await o.put(e,t.clone()),t)).clone()),globalThis.document.createElement=(e,t)=>{let c=n.bind(document)(e,t);if(c instanceof HTMLLinkElement){let i=c.setAttribute;c.setAttribute=async(e,a)=>{if("prefetch"===c.rel&&"href"===e){let n=a+"?timestamp="+l;let t=new URL(location.origin+n);void(await o.match(new Request(t))||s.has(t.href)||(i.call(c,e,n),c.addEventListener("load",function e(){s.add(t.href),c.removeEventListener("load",e)})))}else i.call(c,e,a)}}return c}}